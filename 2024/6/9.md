# 取り組んだ内容一覧
- SQL実践入門

# わかったこと
- 戻り値が単一の値のことをスカラ値と呼ぶ。
- 内部結合と相関サブクエリでどちらを使うのが良いかについては、基本的に結合で記述できる場合は、結合を選択するのが良い。理由は、相関サブクエリをスカラサブクエリとして使うと、結果行数の数だけ相関サブクエリを実行することになるため、かなり高コストな処理になるから。
- 結合のアルゴリズムには以下の3つがある。
  - Nested Loops
  - Hash
  - Sort Merge
- Nested Loops は名前の通り入れ子のループを使うアルゴリズム。
- Nested Loops の動作イメージ
  - 結合対象となるテーブルを1行ずつループしながらスキャンする。このテーブルを駆動表または外部表と呼ぶ。もう一方のテーブルは内部表と呼ぶ。2重ループの内側のループでアクセスされるという意味。
  - 駆動表の1行に対して、内部表を1行ずつスキャンして結合条件に合致すればそれを返却する。
  - 上記の動作を駆動表のすべての行に対して繰り返す。
- Nested Loops の特徴
  - Table_A、Table_B の結合対象の行数を R(A)、R(B) とすると、アクセスされる行数は R(A) × R(B) となる。Nested Loops の実行時間はこの行数に比例する。
  - 1つのステップで処理する行数が少ないため、Hash や Sort Merge と比べてあまりメモリを消費しない。
  - どの DBMS でも必ずサポートしている。
- Nested Loops は A、B どちらを駆動表にするかがパフォーマンスの大きな要因になる。駆動表の行数が小さく、内部表の行数が大きいほど Nested Loops の性能は良いものになる。ただし、これは内部表の結合キーの列にインデックスが存在することが前提である。内部表の結合キーの列にインデックスが存在する場合、そのインデックスを辿ることによって、DBMS は駆動表の1行に対して内部表を馬鹿正直にループする必要がなくなる。つまり内部表のループをある程度スキップできるようになる。内部表が結合キーで一意の場合、アクセス対象行が必ず1行になるので、内部表のループを完全にスキップできる。一意でない場合は、ヒットした複数行に対してループする。内部表が大きいほどインデックスによるループのスキップ効果が大きくなる。ただし、一意でない場合で例えば、ヒットした行がテーブルの大半といったケースだと結局内部表に対するループ回数は多くなり、Nested Loops の性能は悪くなる。

# 次やること
- SQL実践入門

# 学習時間
Today: 1 h 35 m

Total: 956 h 10 m
